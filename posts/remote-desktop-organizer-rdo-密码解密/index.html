<!doctype html><html lang=zh-cn><meta charset=utf-8><meta name=generator content="Hugo 0.64.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><meta name=keywords content="笔记,逆向,.NET"><meta name=description content="前段时间渗透过程发现目标某个服务器上用RDO连接了多个rdp，而这软件的配置文件是以二进制方式保存的，网上也找不到公开的解密方法，就开始逆向"><title>Remote Desktop Organizer (RDO) 密码解密&nbsp;&ndash;&nbsp;WTFSec</title><link rel=stylesheet href=/css/core.min.58bc4672a8045a0810ba4ad30a08c6d5589db1109ca0aa2e07c5e5438201ea8d11642ffa31d8ee7665d6a1b66ab9a3c5.css integrity=sha384-WLxGcqgEWggQukrTCgjG1VidsRCcoKouB8XlQ4IB6o0RZC/6MdjudmXWobZquaPF><meta name=twitter:card content="summary"><meta name=twitter:title content="Remote Desktop Organizer (RDO) 密码解密"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">WTFSec</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>分类</a><a class="nav item" href=/tags/>标签</a><a class="nav item" href=/link/>友链</a>
<input placeholder="Google 站内搜索" id=search_input style=width:150px>
<button onclick=search()><svg width="13" height="13" viewBox="0 0 13 13"><path d="m4.8495 7.8226c.82666.0 1.5262-.29146 2.0985-.87438.57232-.58292.86378-1.2877.87438-2.1144.010599-.82666-.28086-1.5262-.87438-2.0985-.59352-.57232-1.293-.86378-2.0985-.87438-.8055-.010599-1.5103.28086-2.1144.87438-.60414.59352-.8956 1.293-.87438 2.0985.021197.8055.31266 1.5103.87438 2.1144.56172.60414 1.2665.8956 2.1144.87438zm4.4695.2115 3.681 3.6819-1.259 1.284-3.6817-3.7.0019784-.69479-.090043-.098846c-.87973.76087-1.92 1.1413-3.1207 1.1413-1.3553.0-2.5025-.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239.4696-2.4966 1.4088-3.4239c.9392-.92727 2.0864-1.3969 3.4417-1.4088 1.3553-.011889 2.4906.45771 3.406 1.4088.9154.95107 1.379 2.0924 1.3909 3.4239.0 1.2126-.38043 2.2588-1.1413 3.1385l.098834.090049z"/></svg></button></nav></div><script>function search(){const search_value=document.getElementById("search_input").value;if(search_value!==''){window.open("/search/?q="+search_value,"_blank");}}
document.getElementById("search_input").addEventListener("keydown",function(e){if(e.key==="Enter"){search()}});</script></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">Remote Desktop Organizer (RDO) 密码解密</h1><p class="article date"><span class=lang><a>Hzllaga</a> </span>Thursday, April 23, 2020</p></section><article class="article markdown-body"><p>前段时间渗透过程发现目标某个服务器上用RDO连接了多个rdp，而这软件的配置文件是以二进制方式保存的，网上也找不到公开的解密方法，就开始逆向这软件。</p><p>软件是.NET写的，用ConfuserEx混淆代码了，先用网上的工具反混淆，没办法处理的很干净，至少变量名字都还原了，花了点时间看代码找到关键的解密方法：<div class=highlight><pre class=chroma><code class=language-Csharp data-lang=Csharp>        <span class=k>public</span> <span class=k>static</span> <span class=kt>byte</span><span class=p>[</span><span class=p>]</span> <span class=n>smethod_4</span><span class=p>(</span><span class=kt>byte</span><span class=p>[</span><span class=p>]</span> <span class=n>byte_0</span><span class=p>,</span> <span class=kt>byte</span><span class=p>[</span><span class=p>]</span> <span class=n>byte_1</span><span class=p>,</span> <span class=kt>byte</span><span class=p>[</span><span class=p>]</span> <span class=n>byte_2</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>MemoryStream</span> <span class=n>memoryStream</span> <span class=p>=</span> <span class=k>new</span> <span class=n>MemoryStream</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
            <span class=n>Rijndael</span> <span class=n>rijndael</span> <span class=p>=</span> <span class=n>Rijndael</span><span class=p>.</span><span class=n>Create</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
            <span class=n>rijndael</span><span class=p>.</span><span class=n>Key</span> <span class=p>=</span> <span class=n>byte_1</span><span class=p>;</span>
            <span class=n>rijndael</span><span class=p>.</span><span class=n>IV</span> <span class=p>=</span> <span class=n>byte_2</span><span class=p>;</span>
            <span class=n>CryptoStream</span> <span class=n>cryptoStream</span> <span class=p>=</span> <span class=k>new</span> <span class=n>CryptoStream</span><span class=p>(</span><span class=n>memoryStream</span><span class=p>,</span> <span class=n>rijndael</span><span class=p>.</span><span class=n>CreateDecryptor</span><span class=p>(</span><span class=p>)</span><span class=p>,</span> <span class=n>CryptoStreamMode</span><span class=p>.</span><span class=n>Write</span><span class=p>)</span><span class=p>;</span>
            <span class=n>cryptoStream</span><span class=p>.</span><span class=n>Write</span><span class=p>(</span><span class=n>byte_0</span><span class=p>,</span> <span class=m>0</span><span class=p>,</span> <span class=n>byte_0</span><span class=p>.</span><span class=n>Length</span><span class=p>)</span><span class=p>;</span>
            <span class=n>cryptoStream</span><span class=p>.</span><span class=n>Close</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
            <span class=k>return</span> <span class=n>memoryStream</span><span class=p>.</span><span class=n>ToArray</span><span class=p>(</span><span class=p>)</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=k>public</span> <span class=k>static</span> <span class=kt>string</span> <span class=n>smethod_5</span><span class=p>(</span><span class=kt>string</span> <span class=n>string_0</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=kt>string</span> <span class=n>strPassword</span> <span class=p>=</span> <span class=s>&#34;swevA2t62We?5Cr+he4Tac?_E!redafa?re5+2huv*$rU9eS8Ub4?W!!R+s7uthU&#34;</span><span class=p>;</span>
            <span class=kt>byte</span><span class=p>[</span><span class=p>]</span> <span class=n>array</span> <span class=p>=</span> <span class=k>new</span> <span class=kt>byte</span><span class=p>[</span><span class=n>string_0</span><span class=p>.</span><span class=n>Length</span> <span class=p>/</span> <span class=m>2</span><span class=p>]</span><span class=p>;</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span> <span class=n>i</span> <span class=p>&lt;</span> <span class=n>string_0</span><span class=p>.</span><span class=n>Length</span> <span class=p>/</span> <span class=m>2</span><span class=p>;</span> <span class=n>i</span><span class=p>+</span><span class=p>+</span><span class=p>)</span>
            <span class=p>{</span>
                <span class=kt>int</span> <span class=n>num</span> <span class=p>=</span> <span class=n>Convert</span><span class=p>.</span><span class=n>ToInt32</span><span class=p>(</span><span class=n>string_0</span><span class=p>.</span><span class=n>Substring</span><span class=p>(</span><span class=n>i</span> <span class=p>*</span> <span class=m>2</span><span class=p>,</span> <span class=m>2</span><span class=p>)</span><span class=p>,</span> <span class=m>1</span><span class=m>6</span><span class=p>)</span><span class=p>;</span>
                <span class=n>array</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=p>=</span> <span class=p>(</span><span class=kt>byte</span><span class=p>)</span><span class=n>num</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=n>PasswordDeriveBytes</span> <span class=n>passwordDeriveBytes</span> <span class=p>=</span> <span class=k>new</span> <span class=n>PasswordDeriveBytes</span><span class=p>(</span><span class=n>strPassword</span><span class=p>,</span> <span class=k>new</span> <span class=kt>byte</span><span class=p>[</span><span class=p>]</span>
            <span class=p>{</span>
                <span class=m>7</span><span class=m>3</span><span class=p>,</span>
                <span class=m>1</span><span class=m>1</span><span class=m>8</span><span class=p>,</span>
                <span class=m>9</span><span class=m>7</span><span class=p>,</span>
                <span class=m>1</span><span class=m>1</span><span class=m>0</span><span class=p>,</span>
                <span class=m>3</span><span class=m>2</span><span class=p>,</span>
                <span class=m>7</span><span class=m>7</span><span class=p>,</span>
                <span class=m>1</span><span class=m>0</span><span class=m>1</span><span class=p>,</span>
                <span class=m>1</span><span class=m>0</span><span class=m>0</span><span class=p>,</span>
                <span class=m>1</span><span class=m>1</span><span class=m>8</span><span class=p>,</span>
                <span class=m>1</span><span class=m>0</span><span class=m>1</span><span class=p>,</span>
                <span class=m>1</span><span class=m>0</span><span class=m>0</span><span class=p>,</span>
                <span class=m>1</span><span class=m>0</span><span class=m>1</span><span class=p>,</span>
                <span class=m>1</span><span class=m>1</span><span class=m>8</span>
            <span class=p>}</span><span class=p>)</span><span class=p>;</span>
            <span class=kt>byte</span><span class=p>[</span><span class=p>]</span> <span class=n>bytes</span> <span class=p>=</span> <span class=n>smethod_4</span><span class=p>(</span><span class=n>array</span><span class=p>,</span> <span class=n>passwordDeriveBytes</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=m>3</span><span class=m>2</span><span class=p>)</span><span class=p>,</span> <span class=n>passwordDeriveBytes</span><span class=p>.</span><span class=n>GetBytes</span><span class=p>(</span><span class=m>1</span><span class=m>6</span><span class=p>)</span><span class=p>)</span><span class=p>;</span>
            <span class=k>return</span> <span class=n>Encoding</span><span class=p>.</span><span class=n>Unicode</span><span class=p>.</span><span class=n>GetString</span><span class=p>(</span><span class=n>bytes</span><span class=p>)</span><span class=p>;</span>
        <span class=p>}</span>
</code></pre></div></p><p>由于时间有限，稍微根据目标情况写了个一键解密的工具，有需求的可以根据目标环境修改代码，或是直接把配置文件的密码调用上面的方法就可以解密了。</p><p>相关代码都在GitHub上面：<a href=https://github.com/Hzllaga/RDODecrypt target=_blank>https://github.com/Hzllaga/RDODecrypt</a></p></article><section class="article labels"><a class=category href=/categories/%E5%8E%9F%E5%88%9B/>原创</a><a class=tag href=/tags/%E7%AC%94%E8%AE%B0/>笔记</a><a class=tag href=/tags/%E9%80%86%E5%90%91/>逆向</a><a class=tag href=/tags/%2enet/>.NET</a></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/posts/%E6%82%A0%E9%81%8A%E5%8D%A1%E5%AF%AB%E5%85%A5%E4%BB%BB%E6%84%8Fnfc%E8%A8%AD%E5%82%99/><span class=li>&larr;</span>悠遊卡寫入任意NFC設備</a></p></section></div></section><section id=footer><div class=footer-wrap><p class=copyright>©2014-2020 WTFSec.</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p><p class=powerby><span>CDN by </span><a href=https://cf.wtfsec.org target=_blank>Cloudflare</a><span> and </span><a href="https://console.upyun.com/register/?invite=H1xhvqTVV" target=_blank>又拍云</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-83215806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script data-ad-client=ca-pub-4220670081232153 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></body></html>